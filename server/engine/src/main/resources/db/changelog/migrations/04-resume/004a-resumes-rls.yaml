databaseChangeLog:
  - changeSet:
      id: 004a-enable-rls-resumes
      author: cvix
      changes:
        - sql:
            splitStatements: false
            sql: |
              ALTER TABLE resumes ENABLE ROW LEVEL SECURITY;
              ALTER TABLE resumes FORCE ROW LEVEL SECURITY;
              CREATE POLICY resumes_workspace_access_policy ON resumes
              FOR ALL TO PUBLIC
              USING (workspace_id = current_setting('cvix.current_workspace')::uuid)
              WITH CHECK (workspace_id = current_setting('cvix.current_workspace')::uuid);
      rollback:
        - sql:
            splitStatements: false
            sql: |
              DROP POLICY IF EXISTS resumes_workspace_access_policy ON resumes;
              ALTER TABLE resumes NO FORCE ROW LEVEL SECURITY;
              ALTER TABLE resumes DISABLE ROW LEVEL SECURITY;
