# ============================================================================
# Infrastructure Environment Variables (Example/Template)
# ============================================================================
# This file contains the minimum required variables for validating
# Docker Compose files. Copy to .env and fill with actual values.
#
# For local development, use the root .env.example instead.
# ============================================================================

# ----------------------------
# Application
# ----------------------------
APP_NAME=cvix

# ----------------------------
# Database (PostgreSQL)
# ----------------------------
POSTGRESQL_VERSION=16.9-alpine
POSTGRESQL_USER=postgres
POSTGRESQL_PASSWORD=changeme
POSTGRESQL_DB=cvix

# ----------------------------
# Backend Service
# ----------------------------
HOSTNAME=localhost
BACKEND_URL=http://backend.localhost
# R2DBC URL for reactive database operations
DATABASE_URL=r2dbc:postgresql://postgresql:5432/cvix
# JDBC URL for Liquibase migrations (Dual Driver Strategy)
# Liquibase requires traditional JDBC driver, not R2DBC
LIQUIBASE_URL=jdbc:postgresql://postgresql:5432/cvix
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=changeme
SPRING_PROFILES_ACTIVE=dev

# ----------------------------
# Authentication & Security
# ----------------------------
KEYCLOAK_URL=http://keycloak.localhost:8080
OAUTH2_SERVER_URL=http://keycloak.localhost:8080
REALM=cvix
CLIENT_ID=cvix-client
ADMIN_REALM=master
ADMIN_CLIENT_ID=admin-cli
ADMIN_REALM_USERNAME=admin

# ----------------------------
# CORS Configuration
# ----------------------------
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://webapp.localhost
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_ALLOWED_HEADERS=*
CORS_EXPOSED_HEADERS=*
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=3600

# ----------------------------
# Email Configuration
# ----------------------------
SMTP_HOST=maildev
SMTP_PORT=1025
SMTP_FROM_EMAIL=noreply@cvix.com
SMTP_FROM_NAME=cvix

# ----------------------------
# SSL Configuration
# ----------------------------
SSL_KEYSTORE_PASSWORD=changeit
SSL_KEY_ALIAS=ProFileTailors
SSL_KEYSTORE_LOCATION=file:infra/ssl/keystore.jks

# ----------------------------
# PDF Generation
# ----------------------------
PDF_DOCKER_IMAGE=texlive/texlive:latest
PDF_MAX_CONCURRENT_CONTAINERS=3
PDF_TIMEOUT_SECONDS=30
PDF_MEMORY_LIMIT_MB=512
PDF_CPU_QUOTA=50000
PERSIST_LATEX_FILES=false

# Docker Host for PDF generation
# PRODUCTION: Use tcp://docker-socket-proxy:2375 (with socket proxy service)
# LOCAL DEV ONLY: Use unix:///var/run/docker.sock (NOT SECURE FOR PRODUCTION)
DOCKER_HOST=tcp://docker-socket-proxy:2375

# ----------------------------
# Frontend URLs
# ----------------------------
PUBLIC_BASE_URL_PROD=http://landing.localhost
PUBLIC_BASE_DOCS_URL_PROD=http://docs.localhost
PUBLIC_SITE_URL=http://landing.localhost
PUBLIC_BASE_WEBAPP_URL_PROD=http://webapp.localhost

# ----------------------------
# Content Security Policy (CSP)
# ----------------------------
# WARNING: 'unsafe-inline' is only for local development
# In production, generate nonces or use hashes for inline scripts/styles
# Example production values:
#   CSP_SCRIPT_SRC="'self' 'sha256-abc123...' 'sha256-def456...'"
#   CSP_STYLE_SRC="'self' 'sha256-ghi789...'"
#
# Note: Wrap values in double quotes to preserve single-quoted tokens for Docker Compose
CSP_SCRIPT_SRC="'self' 'unsafe-inline'"
CSP_STYLE_SRC="'self' 'unsafe-inline'"

# ----------------------------
# Traefik Configuration (Dokploy)
# ----------------------------
# Domain names for routing
BACKEND_DOMAIN=api.example.com
FRONTEND_DOMAIN=app.example.com

# Certificate resolver name (configured in Dokploy/Traefik)
# Common values: letsencrypt, cloudflare, custom
CERT_RESOLVER=letsencrypt
