---
import { CVIX_API_URL } from "astro:env/client";
import CvixSystemImage from "@cvix/assets/images/cvix-system.png";
import { EmailCaptureForm, OptimizedPicture } from "@cvix/astro-ui";
import { DEFAULT_LOCALE, type Lang, LOCALES } from "@cvix/i18n/astro";
import { useTranslations } from "@/i18n/i18n";

const astroLocale = Astro.currentLocale;
const langToUse: Lang =
	astroLocale && LOCALES[astroLocale as Lang]
		? (astroLocale as Lang)
		: DEFAULT_LOCALE;
const t = useTranslations(langToUse);

// Precompute/memoize translations to avoid repeated lookups (N+1 t() calls)
const translations = {
	badgeText: t("hero.badge.text"),
	title: t("hero.title"),
	subtitle: t("hero.subtitle"),
	earlyAccess: t("hero.earlyAccess"),
	emailPlaceholder: t("hero.email.placeholder"),
	emailButton: t("hero.email.button"),
	emailSuccess: t("hero.email.success"),
	emailError: t("hero.email.error"),
	emailRateLimit: t("hero.email.rateLimit"),
	emailPrivacy: t("hero.email.privacy"),
	mockupAlt: t("hero.mockup.alt"),
};
---

<section class="pt-32 pb-16 md:pt-48 md:pb-32 bg-background overflow-hidden fade-in-section">
  <div class="container mx-auto max-w-7xl px-4 text-center">
    <div
      class="inline-flex items-center rounded-full border border-primary/20 bg-primary/5 px-3 py-1 text-sm font-medium text-primary mb-8 fade-in-section"
    >
      <span class="flex h-2 w-2 rounded-full bg-green-500 mr-2 animate-pulse"></span>
      {translations.badgeText}
    </div>

    <h1
      class="mx-auto mb-6 max-w-4xl text-5xl font-serif font-bold tracking-tight text-foreground sm:text-6xl md:text-7xl leading-[1.1] fade-in-section"
    >
      {translations.title}
    </h1>

    <p
      class="mx-auto mb-4 max-w-2xl text-lg text-muted-foreground md:text-xl fade-in-section"
    >
      {translations.subtitle}
    </p>

    <p
      class="mx-auto mb-10 max-w-2xl text-base text-primary font-medium fade-in-section"
    >
      {translations.earlyAccess}
    </p>

    <!-- Waitlist Form -->
    <div
      id="hero-waitlist"
      class="flex flex-col items-center justify-center gap-4 mb-16 fade-in-section"
    >
      <div class="w-full max-w-md">
        <EmailCaptureForm
          apiUrl={`${CVIX_API_URL}/api/waitlist`}
          emailPlaceholder={translations.emailPlaceholder}
          buttonText={translations.emailButton}
          successMessage={translations.emailSuccess}
          errorMessage={translations.emailError}
          rateLimitMessage={translations.emailRateLimit}
          source="hero-waitlist"
          class="mx-auto max-w-md"
        />
      </div>
      <p class="text-sm text-muted-foreground">
        {translations.emailPrivacy}
      </p>
    </div>

    <div class="relative mx-auto max-w-5xl fade-in-section">
      <OptimizedPicture
        src={CvixSystemImage}
        alt={translations.mockupAlt}
        class="relative mx-auto w-full"
        width={1200}
        height={800}
        loading="eager"
        fetchpriority="high"
      />
    </div>
  </div>
</section>
