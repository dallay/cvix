---
import type { HTMLAttributes } from "astro/types";
import { type Lang, useTranslations } from "@/i18n";
import { cn } from "@cvix/ui/lib/utils";
import type Article from "@/models/article/article.model";
import { cleanEntityId } from "@/utils/collection.entity";
import ArticleCard from "./ArticleCard.astro";
import Waitlist from "./Waitlist.astro";

const currentLocale = Astro.currentLocale as Lang;
const t = useTranslations(currentLocale);

interface Props extends HTMLAttributes<"div"> {
  posts: Article[];
}
const { posts, ...attrs } = Astro.props;
---

<div class={cn("container px-4 mx-auto", attrs.class)} {...attrs}>
  <div class="flex items-center justify-between mb-8">
    <h2 class="text-3xl font-bold tracking-tight">{t("blog.recentArticles")}</h2>
    <div class="flex gap-2">
      <!-- Navigation buttons could go here -->
    </div>
  </div>

  <ul
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12"
    role="list"
    aria-label={t("news.articles")}
  >
    {
      posts.map((post, index) => {
        const items = [];
        // Insert CTA before the 7th item
        if (index === 6) {
          items.push(
            <li class="md:col-span-2 lg:col-span-3">
              <aside class="flex flex-col items-center gap-6 py-8 md:py-12 rounded-2xl bg-muted/50 border border-border/50">
                <Waitlist
                  formId="cta-waitlist-form"
                  title={t("cta.title")}
                  description={t("cta.description")}
                  class="w-full max-w-2xl px-4"
                />
              </aside>
            </li>,
          );
        }
        items.push(
          <li>
            <ArticleCard
              image={post.cover}
              title={post.title}
              description={post.description}
              url={`/${currentLocale}/blog/${cleanEntityId(post.id)}`}
              article={post}
              class="h-full"
            />
          </li>,
        );
        return items;
      })
    }
  </ul>
</div>
